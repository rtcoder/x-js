{"version":3,"file":"index.es.js","sources":["../src/bindings.ts","../src/virtual-dom.ts","../src/main.ts"],"sourcesContent":["export type Binding = {\n  path: string,\n  placeholder: string,\n};\nexport type Bindings = Binding[];\n\nexport function getBindings(content: string | null): Bindings {\n  if (!content) {\n    return [];\n  }\n  const matches = Array.from(content.matchAll(/\\{\\s*([\\w.]+)\\s*\\}/g));\n  return matches.map((match) => ({\n    path: match[1].trim(),\n    placeholder: match[0],\n  }));\n}\n","import {getBindings} from './bindings.ts';\nimport {MixedObject} from './types/mixed-object.ts';\nimport {VNode} from './types/v-node.ts';\n\nfunction getChildren(element: HTMLElement): VNode[] {\n  return Array.from(element.childNodes).map((child) => {\n    if (child.nodeType === Node.ELEMENT_NODE) {\n      return createVirtualDOM(child as HTMLElement);\n    } else if (child.nodeType === Node.TEXT_NODE) {\n      return {\n        type: 'text',\n        content: child.textContent,\n        props: {},\n        children: [],\n        element: child,\n        bindPathList: getBindings(child.textContent),\n      };\n    }\n  }).filter(Boolean) as VNode[];\n}\n\nexport function createVirtualDOM(element: HTMLElement): VNode {\n  const type = element.tagName.toLowerCase();\n  const props: MixedObject = {};\n  const content = element.textContent;\n\n  Array.from(element.attributes).forEach((attr) => {\n    props[attr.name] = attr.value;\n  });\n\n  const children = getChildren(element);\n  const bindings = element.childNodes.length ? [] : getBindings(content);\n  return {type, props, children, content, element, bindPathList: bindings};\n}\n","import {getBindings} from './bindings.ts';\nimport {VNode} from './types/v-node.ts';\nimport {createVirtualDOM} from './virtual-dom.ts';\n\nfunction createReactiveModel(model: any, onChange: (path: string) => void): any {\n  function createProxy(obj: any, path: string[] = []): any {\n    return new Proxy(obj, {\n      get(target, key) {\n        const value = target[key];\n        if (typeof value === 'object' && value !== null) {\n          return createProxy(value, [...path, key as string]);\n        }\n        return value;\n      },\n      set(target, key, value) {\n        console.log('Model changed at:', [...path, key as string].join('.'), 'New value:', value);\n        target[key] = value;\n        onChange([...path, key as string].join('.'));\n        return true;\n      },\n    });\n  }\n\n  return createProxy(model);\n}\n\nfunction updateHTML(root: HTMLElement, vDom: VNode, model: any, path: string): void {\n  vDom.children.forEach((childVNode, index) => {\n    if (childVNode.children.length) {\n      updateHTML(root, childVNode, model, path);\n    }\n\n    if (!childVNode.bindPathList.length) {\n      return;\n    }\n\n    const foundBindings = childVNode.bindPathList.filter((bindPath) => bindPath.path === path);\n    if (!foundBindings.length) {\n      return;\n    }\n    let newContent = childVNode.content || '';\n    childVNode.bindPathList.forEach((binding) => {\n      const value = binding.path.split('.').reduce((obj, key) => obj[key], model);\n      newContent = newContent!.replace(binding.placeholder, value ?? '');\n    });\n    childVNode.element.textContent = newContent;\n  });\n\n\n  const elements = root.querySelectorAll(`[data-bind-path=\"${path}\"]`);\n\n  elements.forEach((element) => {\n    if (element.tagName === 'INPUT') {\n      const input = element as HTMLInputElement;\n      const value = path.split('.').reduce((obj, key) => obj[key], model);\n      if (input.value !== value) {\n        input.value = value;\n      }\n    } else {\n      const value = path.split('.').reduce((obj, key) => obj[key], model);\n      const originalText = element.getAttribute('data-original-text') || element.textContent || '';\n      element.textContent = originalText.replace(`{${path}}`, value ?? '');\n    }\n  });\n}\n\nfunction bindXModel(element: HTMLElement, model: any, path: string): void {\n  const target = path.split('.').reduce((obj, key) => obj[key], model);\n\n  if (element.tagName === 'INPUT') {\n    const input = element as HTMLInputElement;\n\n    // Ustaw wartość początkową\n    input.value = target;\n\n    // Zdarzenie na zmianę wartości\n    input.addEventListener('input', (e) => {\n      const newValue = (e.target as HTMLInputElement).value;\n      const keys = path.split('.');\n      const lastKey = keys.pop()!;\n      const targetObject = keys.reduce((obj, key) => obj[key], model);\n      targetObject[lastKey] = newValue; // To wywoła Proxy\n    });\n  } else {\n    // Ustaw tekst początkowy\n    element.textContent = target;\n  }\n\n  // Dodaj atrybut do identyfikacji elementu podczas aktualizacji\n  element.setAttribute('data-bind-path', path);\n}\n\nfunction bindClick(element: HTMLElement, model: any): void {\n  const clickHandler = element.getAttribute('@click');\n  if (clickHandler) {\n    const fn = new Function('model', `with(model) { ${clickHandler} }`);\n    element.addEventListener('click', () => fn(model));\n  }\n}\n\nfunction bindPlaceholdersUsingVirtualDOM(vNode: VNode, model: any, root: HTMLElement): void {\n  const {content, props, element} = vNode;\n  console.log('element', element);\n  if (content && content.includes('{') && content.includes('}') && element.nodeType === Node.TEXT_NODE) {\n    const bindings = getBindings(content);\n\n    const updateText = () => {\n      let updatedText = content;\n      bindings.forEach(({path, placeholder}) => {\n        const value = path.split('.').reduce((obj, key) => obj[key], model);\n        updatedText = updatedText.replace(placeholder, value ?? '');\n      });\n      element.textContent = updatedText;\n    };\n\n    updateText();\n\n    // Odświeżanie tekstu na zmianę modelu\n    bindings.forEach(({path}) => {\n      createReactiveModel(model, (updatedPath) => {\n        if (updatedPath.startsWith(path.split('.')[0])) {\n          updateText();\n        }\n      });\n    });\n  }\n\n  // Przetwarzaj dzieci rekurencyjnie\n  vNode.children.forEach((childVNode) => {\n    if (typeof childVNode === 'object') {\n      bindPlaceholdersUsingVirtualDOM(childVNode, model, root);\n    }\n  });\n}\n\n\nexport function initializeAppWithVirtualDOM(selector: string, model: any): void {\n  const root = document.querySelector(selector) as HTMLElement;\n  const virtualDOM = createVirtualDOM(root);\n  console.log(virtualDOM);\n  const reactiveModel = createReactiveModel(model, (path) => {\n    updateHTML(root, virtualDOM, reactiveModel, path);\n  });\n\n  function processVNode(vNode: VNode, parentElement: HTMLElement): void {\n    if (vNode.props['x-model']) {\n      bindXModel(parentElement, reactiveModel, vNode.props['x-model']);\n    }\n\n    if (vNode.props['@click']) {\n      bindClick(parentElement, reactiveModel);\n    }\n\n    bindPlaceholdersUsingVirtualDOM(vNode, reactiveModel, root);\n\n    vNode.children.forEach((childVNode, index) => {\n      if (typeof childVNode === 'object') {\n        const childElement = parentElement.childNodes[index] as HTMLElement;\n        processVNode(childVNode, childElement);\n      }\n    });\n  }\n\n  processVNode(virtualDOM, root);\n}\n\n"],"names":["getBindings","content","match","getChildren","element","child","createVirtualDOM","type","props","attr","children","bindings","createReactiveModel","model","onChange","createProxy","obj","path","target","key","value","updateHTML","root","vDom","childVNode","index","bindPath","newContent","binding","input","originalText","bindXModel","newValue","keys","lastKey","targetObject","bindClick","clickHandler","fn","bindPlaceholdersUsingVirtualDOM","vNode","updateText","updatedText","placeholder","updatedPath","initializeAppWithVirtualDOM","selector","virtualDOM","reactiveModel","processVNode","parentElement","childElement"],"mappings":"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"}