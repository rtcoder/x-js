(function(d,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(d=typeof globalThis<"u"?globalThis:d||self,p(d["x-js"]={}))})(this,function(d){"use strict";const p="@model",T="@click",y="@if",E="@for";function L(n){const e=[],i=n.getAttribute(E);if(i){const[,l]=i.split(" in ");return e.push({path:l,placeholder:null}),e}if(n.childNodes.length)return[];const c=C(n.textContent);if(n.nodeType===Node.TEXT_NODE)return c;const t=n.getAttribute(p);return t&&e.push({path:t,placeholder:t}),[...c,...e]}function C(n){return n?Array.from(n.matchAll(/\{\s*([\w.]+)\s*\}/g)).map(i=>({path:i[1].trim(),placeholder:i[0]})):[]}function D(n){return Array.from(n.childNodes).map(e=>{if(e.nodeType===Node.ELEMENT_NODE)return P(e);if(e.nodeType===Node.TEXT_NODE)return{type:"text",content:e.textContent,props:{},children:[],element:e,bindPathList:C(e.textContent),forConfig:null};if(e.nodeType===Node.COMMENT_NODE)return{type:"comment",content:e.textContent,props:{},children:[],element:e,bindPathList:C(e.textContent),forConfig:null}}).filter(Boolean)}function j(n){const e=n.match(/(\w+)\s+in\s+(.+)/);if(!e)throw new Error(`Invalid @for syntax: ${n}`);return{item:e[1],list:e[2]}}function P(n){const e=n.tagName.toLowerCase(),i={},c=n.textContent;Array.from(n.attributes).forEach(r=>{i[r.name]=r.value});const t=i[E];let l=null;t&&(l=j(t));const s=D(n),o=L(n);return n.removeAttribute(p),n.removeAttribute(y),n.removeAttribute(E),n.removeAttribute(T),{type:e,props:i,children:s,content:c,element:n,bindPathList:o,forConfig:l}}function w(n,e){function i(c,t=[]){return Array.isArray(c)?new Proxy(c,{get(l,s){if(console.log(t),console.log(s),console.log("Tablica odczytana:",[...t,s].join(".")),typeof s=="string"&&["push","pop","splice","shift","unshift"].includes(s))return(...r)=>{const u=Array.prototype[s].apply(l,r);return e(t.join(".")),u};const o=l[s];return typeof o=="object"&&o!==null?i(o,[...t,s]):o},set(l,s,o){return console.log("Tablica zmieniona:",[...t,s].join("."),"Nowa wartość:",o),l[s]=o,e(t.join(".")),!0}}):typeof c=="object"&&c!==null?new Proxy(c,{get(l,s){const o=l[s];return typeof o=="object"&&o!==null?i(o,[...t,s]):o},set(l,s,o){return console.log("Model zmieniony:",[...t,s].join("."),"Nowa wartość:",o),l[s]=o,e([...t,s].join(".")),!0}}):c}return i(n)}function O(n,e,i,c){e.children.forEach((t,l)=>{if(t.props[y]){const r=t.props[y];if(new Function("model",`with(model) { return ${r}; }`)(i))t.element.style.display="";else{t.element.style.display="none";return}}if(t.children.length&&O(n,t,i,c),t.props[p]===c){const r=c.split(".").reduce((u,f)=>u[f],i);if(t.element.tagName==="INPUT"){const u=t.element;u.value!==r&&(u.value=r)}else t.element.textContent=r;return}if(!t.bindPathList.length||!t.bindPathList.filter(r=>r.path===c).length)return;let o=t.content||"";t.bindPathList.filter(r=>!!r.placeholder).forEach(r=>{const u=r.path.split(".").reduce((f,a)=>f[a],i);o=o.replace(r.placeholder,u??"")}),t.element.textContent=o})}function F(n,e,i){const c=i.split(".").reduce((t,l)=>t[l],e);if(n.tagName==="INPUT"){const t=n;t.value=c,t.addEventListener("input",l=>{const s=l.target.value,o=i.split("."),r=o.pop(),u=o.reduce((f,a)=>f[a],e);u[r]=s})}else n.textContent=c}function _(n,e,i){const c=e.props[T];if(c){const t=new Function("model",`with(model) { ${c} }`);n.addEventListener("click",()=>t(i))}}function v(n,e){const{content:i,props:c,element:t,bindPathList:l,forConfig:s}=n;if(!s){if(i&&i.includes("{")&&i.includes("}")&&t.nodeType===Node.TEXT_NODE){const o=()=>{let r=i;l.filter(u=>!!u.placeholder).forEach(({path:u,placeholder:f})=>{const a=u.split(".").reduce((m,h)=>m[h],e);r=r.replace(f,a??"")}),t.textContent=r};o(),l.forEach(({path:r})=>{w(e,u=>{u.startsWith(r.split(".")[0])&&o()})})}n.children.forEach(o=>{typeof o=="object"&&v(o,e)})}}function B(n){const{container:e,data:i}=n,c=typeof e=="string"?document.querySelector(e):e,t=P(c);console.log(t);const l=w(i,o=>{O(c,t,l,o)});function s(o,r,u){var h;const{props:f,element:a,forConfig:m}=o;if(f[y]){const g=f[y];if(new Function("model",`with(model) { return ${g}; }`)(u))a.style.display="";else{a.style.display="none";return}}if(m){const{item:g,list:x}=m,N=new Function("model",`with(model) { return ${x}; }`)(u);a.style.display="none";const A=document.createDocumentFragment();N.forEach(R=>{const z={[g]:R},b=a.cloneNode(!0);b.removeAttribute("@for"),b.style.display="";const I=P(b);s(I,b,z),A.appendChild(b)}),(h=r.parentNode)==null||h.replaceChild(A,a);return}f[p]&&F(r,l,f[p]),f[T]&&_(r,o,l),v(o,u),o.children.forEach((g,x)=>{if(typeof g=="object"){const M=r.childNodes[x];s(g,M,u)}})}s(t,c,i)}d.initializeAppWithVirtualDOM=B,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.js.map
