(function(p,d){typeof exports=="object"&&typeof module<"u"?d(exports):typeof define=="function"&&define.amd?define(["exports"],d):(p=typeof globalThis<"u"?globalThis:p||self,d(p["x-js"]={}))})(this,function(p){"use strict";function d(t){const n=g(t.textContent);if(t.nodeType===Node.TEXT_NODE)return n;const o=[],r=t.getAttribute("x-model");return r&&o.push({path:r,placeholder:r}),[...n,...o]}function g(t){return t?Array.from(t.matchAll(/\{\s*([\w.]+)\s*\}/g)).map(o=>({path:o[1].trim(),placeholder:o[0]})):[]}function y(t){return Array.from(t.childNodes).map(n=>{if(n.nodeType===Node.ELEMENT_NODE)return h(n);if(n.nodeType===Node.TEXT_NODE)return{type:"text",content:n.textContent,props:{},children:[],element:n,bindPathList:g(n.textContent)}}).filter(Boolean)}function h(t){const n=t.tagName.toLowerCase(),o={},r=t.textContent;Array.from(t.attributes).forEach(s=>{o[s.name]=s.value});const e=y(t),c=t.childNodes.length?[]:d(t);return{type:n,props:o,children:e,content:r,element:t,bindPathList:c}}function x(t,n){function o(r,e=[]){return new Proxy(r,{get(c,s){const i=c[s];return typeof i=="object"&&i!==null?o(i,[...e,s]):i},set(c,s,i){return console.log("Model changed at:",[...e,s].join("."),"New value:",i),c[s]=i,n([...e,s].join(".")),!0}})}return o(t)}function b(t,n,o,r){n.children.forEach((e,c)=>{if(e.children.length&&b(t,e,o,r),e.props["x-model"]===r){const u=r.split(".").reduce((a,l)=>a[l],o);if(e.element.tagName==="INPUT"){const a=e.element;a.value!==u&&(a.value=u)}else e.element.textContent=u;return}if(!e.bindPathList.length||!e.bindPathList.filter(u=>u.path===r).length)return;let i=e.content||"";e.bindPathList.forEach(u=>{const a=u.path.split(".").reduce((l,f)=>l[f],o);i=i.replace(u.placeholder,a??"")}),e.element.textContent=i})}function E(t,n,o){const r=o.split(".").reduce((e,c)=>e[c],n);if(t.tagName==="INPUT"){const e=t;e.value=r,e.addEventListener("input",c=>{const s=c.target.value,i=o.split("."),u=i.pop(),a=i.reduce((l,f)=>l[f],n);a[u]=s})}else console.log({target:r}),t.textContent=r;t.setAttribute("data-bind-path",o)}function M(t,n){const o=t.getAttribute("@click");if(o){const r=new Function("model",`with(model) { ${o} }`);t.addEventListener("click",()=>r(n))}}function T(t,n){const{content:o,props:r,element:e,bindPathList:c}=t;if(console.log("element",e),o&&o.includes("{")&&o.includes("}")&&e.nodeType===Node.TEXT_NODE){const s=()=>{let i=o;c.forEach(({path:u,placeholder:a})=>{const l=u.split(".").reduce((f,C)=>f[C],n);i=i.replace(a,l??"")}),e.textContent=i};s(),c.forEach(({path:i})=>{x(n,u=>{u.startsWith(i.split(".")[0])&&s()})})}t.children.forEach(s=>{typeof s=="object"&&T(s,n)})}function m(t){const{container:n,data:o}=t,r=typeof n=="string"?document.querySelector(n):n,e=h(r);console.log(e);const c=x(o,i=>{b(r,e,c,i)});function s(i,u){i.props["x-model"]&&E(u,c,i.props["x-model"]),i.props["@click"]&&M(u,c),T(i,c),i.children.forEach((a,l)=>{if(typeof a=="object"){const f=u.childNodes[l];s(a,f)}})}s(e,r)}p.initializeAppWithVirtualDOM=m,Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.js.map
