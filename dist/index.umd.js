(function(d,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(d=typeof globalThis<"u"?globalThis:d||self,p(d["x-js"]={}))})(this,function(d){"use strict";const p="@model",x="@click",g="@if";function C(n){const e=b(n.textContent);if(n.nodeType===Node.TEXT_NODE)return e;const o=[],s=n.getAttribute(p);return s&&o.push({path:s,placeholder:s}),[...e,...o]}function b(n){return n?Array.from(n.matchAll(/\{\s*([\w.]+)\s*\}/g)).map(o=>({path:o[1].trim(),placeholder:o[0]})):[]}function O(n){return Array.from(n.childNodes).map(e=>{if(e.nodeType===Node.ELEMENT_NODE)return T(e);if(e.nodeType===Node.TEXT_NODE)return{type:"text",content:e.textContent,props:{},children:[],element:e,bindPathList:b(e.textContent)};if(e.nodeType===Node.COMMENT_NODE)return{type:"comment",content:e.textContent,props:{},children:[],element:e,bindPathList:b(e.textContent)}}).filter(Boolean)}function T(n){const e=n.tagName.toLowerCase(),o={},s=n.textContent;Array.from(n.attributes).forEach(r=>{o[r.name]=r.value});const t=O(n),u=n.childNodes.length?[]:C(n);return{type:e,props:o,children:t,content:s,element:n,bindPathList:u}}function E(n,e){function o(s,t=[]){return new Proxy(s,{get(u,r){const i=u[r];return typeof i=="object"&&i!==null?o(i,[...t,r]):i},set(u,r,i){return console.log("Model changed at:",[...t,r].join("."),"New value:",i),u[r]=i,e([...t,r].join(".")),!0}})}return o(n)}function h(n,e,o,s){e.children.forEach((t,u)=>{if(t.props[g]){const c=t.props[g];if(new Function("model",`with(model) { return ${c}; }`)(o))t.element.style.display="";else{t.element.style.display="none";return}}if(t.children.length&&h(n,t,o,s),t.props[p]===s){const c=s.split(".").reduce((l,f)=>l[f],o);if(t.element.tagName==="INPUT"){const l=t.element;l.value!==c&&(l.value=c)}else t.element.textContent=c;return}if(!t.bindPathList.length||!t.bindPathList.filter(c=>c.path===s).length)return;let i=t.content||"";t.bindPathList.forEach(c=>{const l=c.path.split(".").reduce((f,a)=>f[a],o);i=i.replace(c.placeholder,l??"")}),t.element.textContent=i})}function M(n,e,o){const s=o.split(".").reduce((t,u)=>t[u],e);if(n.tagName==="INPUT"){const t=n;t.value=s,t.addEventListener("input",u=>{const r=u.target.value,i=o.split("."),c=i.pop(),l=i.reduce((f,a)=>f[a],e);l[c]=r})}else console.log({target:s}),n.textContent=s}function L(n,e){const o=n.getAttribute(x);if(o){const s=new Function("model",`with(model) { ${o} }`);n.addEventListener("click",()=>s(e))}}function P(n,e){const{content:o,props:s,element:t,bindPathList:u}=n;if(console.log("element",t),o&&o.includes("{")&&o.includes("}")&&t.nodeType===Node.TEXT_NODE){const r=()=>{let i=o;u.forEach(({path:c,placeholder:l})=>{const f=c.split(".").reduce((a,y)=>a[y],e);i=i.replace(l,f??"")}),t.textContent=i};r(),u.forEach(({path:i})=>{E(e,c=>{c.startsWith(i.split(".")[0])&&r()})})}n.children.forEach(r=>{typeof r=="object"&&P(r,e)})}function v(n){const{container:e,data:o}=n,s=typeof e=="string"?document.querySelector(e):e,t=T(s);console.log(t);const u=E(o,i=>{h(s,t,u,i)});function r(i,c){const{props:l,element:f}=i;if(l[g]){const a=l[g];if(new Function("model",`with(model) { return ${a}; }`)(o))f.style.display="";else{f.style.display="none";return}}l[p]&&M(c,u,l[p]),l[x]&&L(c,u),P(i,u),i.children.forEach((a,y)=>{if(typeof a=="object"){console.log(c);const m=c.childNodes[y];console.log(m,a),r(a,m)}})}r(t,s)}d.initializeAppWithVirtualDOM=v,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.js.map
