(function(d,l){typeof exports=="object"&&typeof module<"u"?l(exports):typeof define=="function"&&define.amd?define(["exports"],l):(d=typeof globalThis<"u"?globalThis:d||self,l(d["x-js"]={}))})(this,function(d){"use strict";function l(n){return n?Array.from(n.matchAll(/\{\s*([\w.]+)\s*\}/g)).map(i=>({path:i[1].trim(),placeholder:i[0]})):[]}function E(n){return Array.from(n.childNodes).map(r=>{if(r.nodeType===Node.ELEMENT_NODE)return h(r);if(r.nodeType===Node.TEXT_NODE)return{type:"text",content:r.textContent,props:{},children:[],element:r,bindPathList:l(r.textContent)}}).filter(Boolean)}function h(n){const r=n.tagName.toLowerCase(),i={},o=n.textContent;Array.from(n.attributes).forEach(t=>{i[t.name]=t.value});const u=E(n),e=n.childNodes.length?[]:l(o);return{type:r,props:i,children:u,content:o,element:n,bindPathList:e}}function b(n,r){function i(o,u=[]){return new Proxy(o,{get(e,t){const c=e[t];return typeof c=="object"&&c!==null?i(c,[...u,t]):c},set(e,t,c){return console.log("Model changed at:",[...u,t].join("."),"New value:",c),e[t]=c,r([...u,t].join(".")),!0}})}return i(n)}function x(n,r,i,o){r.children.forEach((e,t)=>{if(e.children.length&&x(n,e,i,o),!e.bindPathList.length||!e.bindPathList.filter(a=>a.path===o).length)return;let s=e.content||"";e.bindPathList.forEach(a=>{const f=a.path.split(".").reduce((p,g)=>p[g],i);s=s.replace(a.placeholder,f??"")}),e.element.textContent=s}),n.querySelectorAll(`[data-bind-path="${o}"]`).forEach(e=>{if(e.tagName==="INPUT"){const t=e,c=o.split(".").reduce((s,a)=>s[a],i);t.value!==c&&(t.value=c)}else{const t=o.split(".").reduce((s,a)=>s[a],i),c=e.getAttribute("data-original-text")||e.textContent||"";e.textContent=c.replace(`{${o}}`,t??"")}})}function T(n,r,i){const o=i.split(".").reduce((u,e)=>u[e],r);if(n.tagName==="INPUT"){const u=n;u.value=o,u.addEventListener("input",e=>{const t=e.target.value,c=i.split("."),s=c.pop(),a=c.reduce((f,p)=>f[p],r);a[s]=t})}else n.textContent=o;n.setAttribute("data-bind-path",i)}function C(n,r){const i=n.getAttribute("@click");if(i){const o=new Function("model",`with(model) { ${i} }`);n.addEventListener("click",()=>o(r))}}function y(n,r,i){const{content:o,props:u,element:e}=n;if(console.log("element",e),o&&o.includes("{")&&o.includes("}")&&e.nodeType===Node.TEXT_NODE){const t=l(o),c=()=>{let s=o;t.forEach(({path:a,placeholder:f})=>{const p=a.split(".").reduce((g,v)=>g[v],r);s=s.replace(f,p??"")}),e.textContent=s};c(),t.forEach(({path:s})=>{b(r,a=>{a.startsWith(s.split(".")[0])&&c()})})}n.children.forEach(t=>{typeof t=="object"&&y(t,r)})}function M(n,r){const i=document.querySelector(n),o=h(i);console.log(o);const u=b(r,t=>{x(i,o,u,t)});function e(t,c){t.props["x-model"]&&T(c,u,t.props["x-model"]),t.props["@click"]&&C(c,u),y(t,u),t.children.forEach((s,a)=>{if(typeof s=="object"){const f=c.childNodes[a];e(s,f)}})}e(o,i)}d.initializeAppWithVirtualDOM=M,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.js.map
