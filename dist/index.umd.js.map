{"version":3,"file":"index.umd.js","sources":["../src/bindings.ts","../src/virtual-dom.ts","../src/main.ts"],"sourcesContent":["export type Binding = {\n  path: string,\n  placeholder: string,\n};\nexport type Bindings = Binding[];\n\nexport function getBindings(content: string | null): Bindings {\n  if (!content) {\n    return [];\n  }\n  const matches = Array.from(content.matchAll(/\\{\\s*([\\w.]+)\\s*\\}/g));\n  return matches.map((match) => ({\n    path: match[1].trim(),\n    placeholder: match[0],\n  }));\n}\n","import {getBindings} from './bindings.ts';\nimport {MixedObject} from './types/mixed-object.ts';\nimport {VNode} from './types/v-node.ts';\n\nfunction getChildren(element: HTMLElement): VNode[] {\n  return Array.from(element.childNodes).map((child) => {\n    if (child.nodeType === Node.ELEMENT_NODE) {\n      return createVirtualDOM(child as HTMLElement);\n    } else if (child.nodeType === Node.TEXT_NODE) {\n      return {\n        type: 'text',\n        content: child.textContent,\n        props: {},\n        children: [],\n        element: child,\n        bindPathList: getBindings(child.textContent),\n      };\n    }\n  }).filter(Boolean) as VNode[];\n}\n\nexport function createVirtualDOM(element: HTMLElement): VNode {\n  const type = element.tagName.toLowerCase();\n  const props: MixedObject = {};\n  const content = element.textContent;\n\n  Array.from(element.attributes).forEach((attr) => {\n    props[attr.name] = attr.value;\n  });\n\n  const children = getChildren(element);\n  const bindings = element.childNodes.length ? [] : getBindings(content);\n  return {type, props, children, content, element, bindPathList: bindings};\n}\n","import {getBindings} from './bindings.ts';\nimport {VNode} from './types/v-node.ts';\nimport {createVirtualDOM} from './virtual-dom.ts';\n\nfunction createReactiveModel(model: any, onChange: (path: string) => void): any {\n  function createProxy(obj: any, path: string[] = []): any {\n    return new Proxy(obj, {\n      get(target, key) {\n        const value = target[key];\n        if (typeof value === 'object' && value !== null) {\n          return createProxy(value, [...path, key as string]);\n        }\n        return value;\n      },\n      set(target, key, value) {\n        console.log('Model changed at:', [...path, key as string].join('.'), 'New value:', value);\n        target[key] = value;\n        onChange([...path, key as string].join('.'));\n        return true;\n      },\n    });\n  }\n\n  return createProxy(model);\n}\n\nfunction updateHTML(root: HTMLElement, vDom: VNode, model: any, path: string): void {\n  vDom.children.forEach((childVNode, index) => {\n    if (childVNode.children.length) {\n      updateHTML(root, childVNode, model, path);\n    }\n\n    if (!childVNode.bindPathList.length) {\n      return;\n    }\n\n    const foundBindings = childVNode.bindPathList.filter((bindPath) => bindPath.path === path);\n    if (!foundBindings.length) {\n      return;\n    }\n    let newContent = childVNode.content || '';\n    childVNode.bindPathList.forEach((binding) => {\n      const value = binding.path.split('.').reduce((obj, key) => obj[key], model);\n      newContent = newContent!.replace(binding.placeholder, value ?? '');\n    });\n    childVNode.element.textContent = newContent;\n  });\n\n\n  const elements = root.querySelectorAll(`[data-bind-path=\"${path}\"]`);\n\n  elements.forEach((element) => {\n    if (element.tagName === 'INPUT') {\n      const input = element as HTMLInputElement;\n      const value = path.split('.').reduce((obj, key) => obj[key], model);\n      if (input.value !== value) {\n        input.value = value;\n      }\n    } else {\n      const value = path.split('.').reduce((obj, key) => obj[key], model);\n      const originalText = element.getAttribute('data-original-text') || element.textContent || '';\n      element.textContent = originalText.replace(`{${path}}`, value ?? '');\n    }\n  });\n}\n\nfunction bindXModel(element: HTMLElement, model: any, path: string): void {\n  const target = path.split('.').reduce((obj, key) => obj[key], model);\n\n  if (element.tagName === 'INPUT') {\n    const input = element as HTMLInputElement;\n\n    // Ustaw wartość początkową\n    input.value = target;\n\n    // Zdarzenie na zmianę wartości\n    input.addEventListener('input', (e) => {\n      const newValue = (e.target as HTMLInputElement).value;\n      const keys = path.split('.');\n      const lastKey = keys.pop()!;\n      const targetObject = keys.reduce((obj, key) => obj[key], model);\n      targetObject[lastKey] = newValue; // To wywoła Proxy\n    });\n  } else {\n    // Ustaw tekst początkowy\n    element.textContent = target;\n  }\n\n  // Dodaj atrybut do identyfikacji elementu podczas aktualizacji\n  element.setAttribute('data-bind-path', path);\n}\n\nfunction bindClick(element: HTMLElement, model: any): void {\n  const clickHandler = element.getAttribute('@click');\n  if (clickHandler) {\n    const fn = new Function('model', `with(model) { ${clickHandler} }`);\n    element.addEventListener('click', () => fn(model));\n  }\n}\n\nfunction bindPlaceholdersUsingVirtualDOM(vNode: VNode, model: any, root: HTMLElement): void {\n  const {content, props, element} = vNode;\n  console.log('element', element);\n  if (content && content.includes('{') && content.includes('}') && element.nodeType === Node.TEXT_NODE) {\n    const bindings = getBindings(content);\n\n    const updateText = () => {\n      let updatedText = content;\n      bindings.forEach(({path, placeholder}) => {\n        const value = path.split('.').reduce((obj, key) => obj[key], model);\n        updatedText = updatedText.replace(placeholder, value ?? '');\n      });\n      element.textContent = updatedText;\n    };\n\n    updateText();\n\n    // Odświeżanie tekstu na zmianę modelu\n    bindings.forEach(({path}) => {\n      createReactiveModel(model, (updatedPath) => {\n        if (updatedPath.startsWith(path.split('.')[0])) {\n          updateText();\n        }\n      });\n    });\n  }\n\n  // Przetwarzaj dzieci rekurencyjnie\n  vNode.children.forEach((childVNode) => {\n    if (typeof childVNode === 'object') {\n      bindPlaceholdersUsingVirtualDOM(childVNode, model, root);\n    }\n  });\n}\n\n\nexport function initializeAppWithVirtualDOM(selector: string, model: any): void {\n  const root = document.querySelector(selector) as HTMLElement;\n  const virtualDOM = createVirtualDOM(root);\n  console.log(virtualDOM);\n  const reactiveModel = createReactiveModel(model, (path) => {\n    updateHTML(root, virtualDOM, reactiveModel, path);\n  });\n\n  function processVNode(vNode: VNode, parentElement: HTMLElement): void {\n    if (vNode.props['x-model']) {\n      bindXModel(parentElement, reactiveModel, vNode.props['x-model']);\n    }\n\n    if (vNode.props['@click']) {\n      bindClick(parentElement, reactiveModel);\n    }\n\n    bindPlaceholdersUsingVirtualDOM(vNode, reactiveModel, root);\n\n    vNode.children.forEach((childVNode, index) => {\n      if (typeof childVNode === 'object') {\n        const childElement = parentElement.childNodes[index] as HTMLElement;\n        processVNode(childVNode, childElement);\n      }\n    });\n  }\n\n  processVNode(virtualDOM, root);\n}\n\n"],"names":["getBindings","content","match","getChildren","element","child","createVirtualDOM","type","props","attr","children","bindings","createReactiveModel","model","onChange","createProxy","obj","path","target","key","value","updateHTML","root","vDom","childVNode","index","bindPath","newContent","binding","input","originalText","bindXModel","newValue","keys","lastKey","targetObject","bindClick","clickHandler","fn","bindPlaceholdersUsingVirtualDOM","vNode","updateText","updatedText","placeholder","updatedPath","initializeAppWithVirtualDOM","selector","virtualDOM","reactiveModel","processVNode","parentElement","childElement"],"mappings":"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"}